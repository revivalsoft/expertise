{% extends 'base.html.twig' %}

{% block title %}Upload CSV
{% endblock %}

{% block body %}
	<div class="container my-5">
		<div class="row g-4">
			<div class="col-lg-6 mx-auto">
				<div class="card shadow-sm border-0">
					<div class="card-header bg-primary text-white">
						<h5 class="mb-0">Uploader un fichier CSV</h5>
					</div>
					<div class="card-body">
						{{ form_start(form, {
						'method': 'POST',
						'attr': {
							'enctype': 'multipart/form-data',
							'data-turbo': 'false'
						}
					}) }}

						<div class="mb-3">
							{{ form_label(form.csv, null, {'label_attr': {'class': 'form-label'}}) }}
							{{ form_widget(form.csv, {'attr': {'class': 'form-control'}}) }}
							{{ form_errors(form.csv) }}
						</div>

						<button type="submit" class="btn btn-success w-100">Envoyer</button>

						{{ form_end(form) }}


						{% if csvFiles is not empty %}
							<hr class="my-4">
							<h6 class="mb-3">üóë Supprimer un fichier CSV :</h6>
							<ul class="list-group">
								{% for file in csvFiles %}
									<li class="list-group-item d-flex justify-content-between align-items-center">
										<span>{{ file }}</span>
										<form method="POST" action="{{ path('csv_delete', {'filename': file}) }}" onsubmit="return confirm('Voulez-vous vraiment supprimer le fichier : {{ file }} ?');">
											<button type="submit" class="btn btn-sm btn-outline-danger">Supprimer</button>
										</form>
									</li>
								{% endfor %}
							</ul>
						{% endif %}


						{% if message %}
							<div class="alert alert-info mt-4" role="alert">
								{{ message }}
							</div>
						{% endif %}
					</div>
				</div>
			</div>

			<div class="col-lg-8 mx-auto">
				<div class="card shadow-sm border-0">
					<div class="card-header bg-secondary text-white">
						<h5 class="mb-0">Fichiers CSV disponibles</h5>
					</div>
					<div class="card-body">
						<form method="GET" action="{{ path('app_regression') }}" class="row g-3 align-items-end">
							<div class="col-md-6">
								<label for="csv" class="form-label">
									üìÅ Veuillez s√©lectionner un fichier CSV √† analyser :
								</label>
								{% if csvFiles is not empty %}
									<select id="csv" name="file" class="form-select" required>
										<option value="" disabled selected>-- Choisissez un fichier --</option>
										{% for file in csvFiles %}
											<option value="{{ file }}">{{ file }}</option>
										{% endfor %}
									</select>
								{% else %}
									<p class="text-muted">Aucun fichier CSV trouv√© dans le dossier de destination.</p>
								{% endif %}
							</div>

							<div class="col-md-4">
								<label for="surface" class="form-label">Indiquez la surface √† estimer (en m¬≤) :</label>
								<input type="number" id="surface" name="surface" class="form-control" min="1" required>
							</div>

							<div class="col-md-2">
								<button type="submit" class="btn btn-warning w-100">Analyser</button>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>
{% endblock %}
